<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <title>CBME × EPA 核心能力雷達圖</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Tailwind 用來吃 class，例如 bg-slate-50 等 -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React / ReactDOM / Recharts / Babel：用 CDN，免安裝 npm -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.15.2/umd/Recharts.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-slate-50">
    <div id="root"></div>

    <!-- 用 Babel 直接在瀏覽器編譯 JSX -->
    <script type="text/babel" data-presets="react">
      const {
        Radar,
        RadarChart,
        PolarGrid,
        PolarAngleAxis,
        PolarRadiusAxis,
        ResponsiveContainer,
        Legend,
        Tooltip,
      } = Recharts;

      // 七大核心能力 (SIRIPPP)
      const competencies = [
        { subject: 'S: Systems (制度體系)', full: 'Systems-based Practice' },
        { subject: 'I: Interpersonal (溝通技巧)', full: 'Interpersonal & Communication' },
        { subject: 'R: Reflection (反思學習)', full: 'Practice-based Learning' },
        { subject: 'I: Info/Knowledge (醫學知識)', full: 'Medical Knowledge' },
        { subject: 'P: Professionalism (專業素養)', full: 'Professionalism' },
        { subject: 'P: Patient Care (病人照護)', full: 'Patient Care' },
        { subject: 'P: Partners (跨域團隊)', full: 'Inter-professional Practice' },
      ];

      // 11 項 EPA 任務
      const epaScenarios = [
        {
          id: 'epa1',
          name: 'EPA 1: 提供病人藥物吸入治療照護',
          color: '#3b82f6',
          data: [
            { subject: 'S: Systems (制度體系)', A: 40 },
            { subject: 'I: Interpersonal (溝通技巧)', A: 60 },
            { subject: 'R: Reflection (反思學習)', A: 40 },
            { subject: 'I: Info/Knowledge (醫學知識)', A: 80 },
            { subject: 'P: Professionalism (專業素養)', A: 70 },
            { subject: 'P: Patient Care (病人照護)', A: 85 },
            { subject: 'P: Partners (跨域團隊)', A: 40 },
          ],
        },
        {
          id: 'epa2',
          name: 'EPA 2: 提供病人痰液清除照護',
          color: '#06b6d4',
          data: [
            { subject: 'S: Systems (制度體系)', A: 45 },
            { subject: 'I: Interpersonal (溝通技巧)', A: 50 },
            { subject: 'R: Reflection (反思學習)', A: 40 },
            { subject: 'I: Info/Knowledge (醫學知識)', A: 75 },
            { subject: 'P: Professionalism (專業素養)', A: 75 },
            { subject: 'P: Patient Care (病人照護)', A: 90 },
            { subject: 'P: Partners (跨域團隊)', A: 50 },
          ],
        },
        {
          id: 'epa3',
          name: 'EPA 3: 提供胸腹手術病人肺擴張治療照護',
          color: '#14b8a6',
          data: [
            { subject: 'S: Systems (制度體系)', A: 50 },
            { subject: 'I: Interpersonal (溝通技巧)', A: 75 },
            { subject: 'R: Reflection (反思學習)', A: 50 },
            { subject: 'I: Info/Knowledge (醫學知識)', A: 80 },
            { subject: 'P: Professionalism (專業素養)', A: 70 },
            { subject: 'P: Patient Care (病人照護)', A: 85 },
            { subject: 'P: Partners (跨域團隊)', A: 60 },
          ],
        },
        {
          id: 'epa4',
          name: 'EPA 4: 提供病人呼吸功能改善處置',
          color: '#10b981',
          data: [
            { subject: 'S: Systems (制度體系)', A: 40 },
            { subject: 'I: Interpersonal (溝通技巧)', A: 85 },
            { subject: 'R: Reflection (反思學習)', A: 60 },
            { subject: 'I: Info/Knowledge (醫學知識)', A: 75 },
            { subject: 'P: Professionalism (專業素養)', A: 80 },
            { subject: 'P: Patient Care (病人照護)', A: 80 },
            { subject: 'P: Partners (跨域團隊)', A: 50 },
          ],
        },
        {
          id: 'epa5',
          name: 'EPA 5: 提供病人氧氣治療照護',
          color: '#84cc16',
          data: [
            { subject: 'S: Systems (制度體系)', A: 60 },
            { subject: 'I: Interpersonal (溝通技巧)', A: 50 },
            { subject: 'R: Reflection (反思學習)', A: 40 },
            { subject: 'I: Info/Knowledge (醫學知識)', A: 70 },
            { subject: 'P: Professionalism (專業素養)', A: 70 },
            { subject: 'P: Patient Care (病人照護)', A: 85 },
            { subject: 'P: Partners (跨域團隊)', A: 40 },
          ],
        },
        {
          id: 'epa6',
          name: 'EPA 6: 使用侵襲性呼吸器病人之初始設定及照護',
          color: '#eab308',
          data: [
            { subject: 'S: Systems (制度體系)', A: 75 },
            { subject: 'I: Interpersonal (溝通技巧)', A: 50 },
            { subject: 'R: Reflection (反思學習)', A: 80 },
            { subject: 'I: Info/Knowledge (醫學知識)', A: 95 },
            { subject: 'P: Professionalism (專業素養)', A: 85 },
            { subject: 'P: Patient Care (病人照護)', A: 95 },
            { subject: 'P: Partners (跨域團隊)', A: 80 },
          ],
        },
        {
          id: 'epa7',
          name: 'EPA 7: 呼吸窘迫病人之處置',
          color: '#f97316',
          data: [
            { subject: 'S: Systems (制度體系)', A: 70 },
            { subject: 'I: Interpersonal (溝通技巧)', A: 60 },
            { subject: 'R: Reflection (反思學習)', A: 70 },
            { subject: 'I: Info/Knowledge (醫學知識)', A: 95 },
            { subject: 'P: Professionalism (專業素養)', A: 90 },
            { subject: 'P: Patient Care (病人照護)', A: 100 },
            { subject: 'P: Partners (跨域團隊)', A: 85 },
          ],
        },
        {
          id: 'epa8',
          name: 'EPA 8: 使用呼吸器病人之緊急處置',
          color: '#ef4444',
          data: [
            { subject: 'S: Systems (制度體系)', A: 80 },
            { subject: 'I: Interpersonal (溝通技巧)', A: 70 },
            { subject: 'R: Reflection (反思學習)', A: 60 },
            { subject: 'I: Info/Knowledge (醫學知識)', A: 95 },
            { subject: 'P: Professionalism (專業素養)', A: 90 },
            { subject: 'P: Patient Care (病人照護)', A: 100 },
            { subject: 'P: Partners (跨域團隊)', A: 90 },
          ],
        },
        {
          id: 'epa9',
          name: 'EPA 9: 使用呼吸器病人之轉送照護',
          color: '#d946ef',
          data: [
            { subject: 'S: Systems (制度體系)', A: 95 },
            { subject: 'I: Interpersonal (溝通技巧)', A: 85 },
            { subject: 'R: Reflection (反思學習)', A: 70 },
            { subject: 'I: Info/Knowledge (醫學知識)', A: 80 },
            { subject: 'P: Professionalism (專業素養)', A: 85 },
            { subject: 'P: Patient Care (病人照護)', A: 90 },
            { subject: 'P: Partners (跨域團隊)', A: 90 },
          ],
        },
        {
          id: 'epa10',
          name: 'EPA 10: 使用侵襲性呼吸器病人之脫離照護',
          color: '#8b5cf6',
          data: [
            { subject: 'S: Systems (制度體系)', A: 70 },
            { subject: 'I: Interpersonal (溝通技巧)', A: 80 },
            { subject: 'R: Reflection (反思學習)', A: 90 },
            { subject: 'I: Info/Knowledge (醫學知識)', A: 95 },
            { subject: 'P: Professionalism (專業素養)', A: 85 },
            { subject: 'P: Patient Care (病人照護)', A: 90 },
            { subject: 'P: Partners (跨域團隊)', A: 95 },
          ],
        },
        {
          id: 'epa11',
          name: 'EPA 11: 移除病人氣管內管之照護',
          color: '#64748b',
          data: [
            { subject: 'S: Systems (制度體系)', A: 65 },
            { subject: 'I: Interpersonal (溝通技巧)', A: 75 },
            { subject: 'R: Reflection (反思學習)', A: 70 },
            { subject: 'I: Info/Knowledge (醫學知識)', A: 85 },
            { subject: 'P: Professionalism (專業素養)', A: 85 },
            { subject: 'P: Patient Care (病人照護)', A: 95 },
            { subject: 'P: Partners (跨域團隊)', A: 70 },
          ],
        },
      ];

      function App() {
        const [selectedIds, setSelectedIds] = React.useState(['epa6']); // 預設顯示 EPA 6

        const selectedEPAs = React.useMemo(
          () => epaScenarios.filter((e) => selectedIds.includes(e.id)),
          [selectedIds]
        );

        const chartData = React.useMemo(() => {
          return competencies.map((comp) => {
            const row = { subject: comp.subject };
            selectedEPAs.forEach((epa) => {
              const found = epa.data.find((d) => d.subject === comp.subject);
              if (found) row[epa.id] = found.A;
            });
            return row;
          });
        }, [selectedEPAs]);

        const toggleEPA = (id) => {
          setSelectedIds((prev) => {
            const exists = prev.includes(id);
            if (exists) {
              if (prev.length === 1) return prev; // 至少保留一個
              return prev.filter((x) => x !== id);
            } else {
              return [...prev, id];
            }
          });
        };

        return (
          <div className="min-h-screen bg-slate-50 p-2 md:p-6 text-slate-800">
            <div className="max-w-7xl mx-auto mb-6 bg-white p-6 rounded-xl shadow-sm border border-slate-200">
              <h1 className="text-2xl md:text-3xl font-bold text-slate-900 mb-2">
                CBME 概念導航：11項公版 EPA × SIRIPPP 核心能力雷達圖
              </h1>
              <p className="text-sm text-slate-600">
                勾選右側任務，可<strong>疊加顯示</strong>不同 EPA 對七大核心能力（SIRIPPP）的需求強度。
              </p>
            </div>

            <div className="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-6">
              {/* 左側：雷達圖 */}
              <div className="lg:col-span-8 bg-white p-4 rounded-xl shadow-lg border border-slate-200">
                <div className="flex justify-between items-center mb-2">
                  <h2 className="font-bold text-slate-700">能力雷達視圖</h2>
                  <span className="text-xs text-slate-400">
                    已顯示 {selectedEPAs.length} 個 EPA 任務
                  </span>
                </div>
                <div style={{ width: '100%', height: 500 }}>
                  <ResponsiveContainer>
                    <RadarChart data={chartData} outerRadius="70%">
                      <PolarGrid gridType="polygon" />
                      <PolarAngleAxis
                        dataKey="subject"
                        tick={{ fill: '#475569', fontSize: 12, fontWeight: 600 }}
                      />
                      <PolarRadiusAxis angle={30} domain={[0, 100]} tick={false} axisLine={false} />
                      {selectedEPAs.map((epa) => (
                        <Radar
                          key={epa.id}
                          name={epa.name}
                          dataKey={epa.id}
                          stroke={epa.color}
                          strokeWidth={2}
                          fill={epa.color}
                          fillOpacity={selectedEPAs.length > 1 ? 0.15 : 0.35}
                        />
                      ))}
                      <Tooltip />
                      <Legend />
                    </RadarChart>
                  </ResponsiveContainer>
                </div>
              </div>

              {/* 右側：任務清單 */}
              <div className="lg:col-span-4 flex flex-col gap-4">
                <div className="bg-white p-4 rounded-xl shadow-md border border-slate-200 max-h-[550px] overflow-y-auto">
                  <h3 className="font-bold text-slate-800 mb-3 text-sm">
                    EPA 任務清單（可複選）
                  </h3>
                  <div className="space-y-2 text-sm">
                    {epaScenarios.map((epa) => {
                      const checked = selectedIds.includes(epa.id);
                      return (
                        <label
                          key={epa.id}
                          className={
                            'flex items-start gap-2 p-2 rounded-lg border cursor-pointer transition ' +
                            (checked
                              ? 'bg-slate-50 border-slate-300'
                              : 'bg-white border-transparent hover:bg-slate-50')
                          }
                        >
                          <input
                            type="checkbox"
                            className="mt-1"
                            checked={checked}
                            onChange={() => toggleEPA(epa.id)}
                          />
                          <div className="flex-1">
                            <div
                              className="font-bold"
                              style={{ color: checked ? epa.color : '#334155' }}
                            >
                              {epa.name.split(':')[0]}
                            </div>
                            <div className="text-xs text-slate-500">
                              {epa.name.split(':')[1]}
                            </div>
                          </div>
                        </label>
                      );
                    })}
                  </div>
                </div>

                {/* SIRIPPP 說明 */}
                <div className="bg-slate-800 text-white p-4 rounded-xl shadow-md text-xs">
                  <div className="font-bold text-slate-300 mb-2">
                    SIRIPPP 七大核心能力（地圖上的主幹道）
                  </div>
                  <ul className="space-y-1">
                    {competencies.map((c) => (
                      <li key={c.subject} className="flex gap-2">
                        <span className="w-6 text-slate-300">
                          {c.subject.split(':')[0]}：
                        </span>
                        <span>{c.subject.split(':')[1]}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>

